---
description: 总结数据库相关知识
---

# SQL

由于应用需要保存用户数据，而且伴随着应用程序越来越复杂，数据量越来越大，管理这些数据面临着读写文件并且解析数据需要大量的重复代码，而且从成千上万的数据中查询出指定数据需要复杂逻辑，并且每个程序各自完成自己读写数据的代码不仅效率低，还容易出错，而且各个程序访问数据的接口都不相同，数据难以复用，因此，数据库作为一种专门管理数据的软件诞生了，应用不需要自己管理数据，通过数据库提供的接口来读写数据就好了。SQL是结构化查询语言的缩写，用来访问和操作数据库系统。SQL语句既可以查询数据库中的数据，也可以添加、更新和删除数据库中的数据，还可以对数据库进行管理和维护操作。不同的数据库，都支持SQL，这样，我们通过学习SQL这一种语言，就可以操作各种不同的数据库。

### 数据模型

数据库按照数据结构来组织、存储和管理数据，分为`层次模型` 、`网状模型` 、`关系模型` 。

层次模型是按上下级的层次关系来组织数据的一种方式。

![&#x5C42;&#x6B21;&#x6A21;&#x578B;](../../.gitbook/assets/tu-pian%20%2812%29.png)

网状模型是把每个数据节点和其他很多节点连接起来。

![&#x7F51;&#x72B6;&#x6A21;&#x578B;](../../.gitbook/assets/tu-pian%20%282%29.png)

关系模型把数据看作一个二位表格，任何数据都可以通过行列号来确定。

![&#x5173;&#x7CFB;&#x6A21;&#x578B;](../../.gitbook/assets/tu-pian%20%287%29.png)

### 数据类型

| 名称 | 类型 | 说明 |
| :--- | :--- | :--- |
| INT | 整型 | 4字节整数类型，范围约+/-21亿 |
| BIGINT | 长整型 | 8字节整数类型，范围约+/-922亿亿 |
| REAL | 浮点型 | 4字节浮点数，范围约+/-1038 |
| DOUBLE | 浮点型 | 8字节浮点数，范围约+/-10308 |
| DECIMAL\(M,N\) | 高精度小数 | 由用户指定精度的小数，例如，DECIMAL\(20,10\)表示一共20位，其中小数10位，通常用于财务计算 |
| CHAR\(N\) | 定长字符串 | 存储指定长度的字符串，例如，CHAR\(100\)总是存储100个字符的字符串 |
| VARCHAR\(N\) | 变长字符串 | 存储可变长度的字符串，例如，VARCHAR\(100\)可以存储0~100个字符的字符串 |
| BOOLEAN | 布尔类型 | 存储True或者False |
| DATE | 日期类型 | 存储日期，例如，2018-06-22 |
| TIME | 时间类型 | 存储时间，例如，12:20:59 |
| DATETIME | 日期和时间类型 | 存储日期+时间，例如，2018-06-22 12:20:59 |

这里`REAL` 又可以写成`FLOAT(24)` ，还有一些不常用的数据类型，例如，`TINYINT` （范围在0-255），各数据库厂商还会支持特定的数据类型，例如`Json` ，通常来说，`BIGINT` 能满足整数存储的需求，`VARCHAR(N)` 能满足字符串存储的需求。

### 主流关系数据库

目前，主流的关系数据库主要分为以下几类：

1. 商用数据库，例如：[Oracle](https://www.oracle.com)，[SQL Server](https://www.microsoft.com/sql-server/)，[DB2](https://www.ibm.com/db2/)等；
2. 开源数据库，例如：[MySQL](https://www.mysql.com/)，[PostgreSQL](https://www.postgresql.org/)等；
3. 桌面数据库，以微软[Access](https://products.office.com/access)为代表，适合桌面应用程序使用；
4. 嵌入式数据库，以[Sqlite](https://sqlite.org/)为代表，适合手机应用和桌面程序

### SQL

SQL定义了如下操作数据库的能力：

1. DDL（ Data Definition Language）：允许用户定义数据（创建表、删除表、修改表结构），通常由数据库管理员执行。
2. DML（Data Manipulation Language）：用户添加、删除、更新数据
3. DQL（Data Query Language）：用户查询数据库

### 语法特点

不区分大小写，但是针对不同的数据库，对于表名、列名有的区分大小写，有的不区分大小写。同一个数据库，有的在Linux区分大小写，有的在Windows上不区分大小写。一般的，SQL的关键字总是大写，表名，列名均小写。

### 安装

请参考[安装MySQL](https://www.liaoxuefeng.com/wiki/1177760294764384/1179611020917408)

### 关系模型

我们将表的每一行称为记录（record），每一列称为字段（column）

### 主键

关系表中，一个很重要的约束就是，任意两条记录不能重复，能通过某个字段唯一区分出不同的记录，这个字段被称为`主键` 。

| id | class\_id | name | gender | score |
| :--- | :--- | :--- | :--- | :--- |
| 1 | 1 | 小明 | M | 90 |
| 2 | 1 | 小红 | F | 95 |

例如我们将`name` 设为`主键` ，那么通过名字`小明` 或者`小红` 就可以唯一确定一条记录，但是这样就没法存储同名的同学了，因为插入`相同` 主键的两条记录是不被允许的。

由于`主键` 是用来唯一定位定位记录的，修改了主键，会造成一些列影响，因此，选取主键的基本原则是：**不使用任何业务相关的字段作为主键**，我们一般选取`id` 作为`主键` ，可以作为`id` 的字段类型分为以下两种。

1. 自增整数类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键；
2. 全局唯一GUID类型：使用一种全局唯一的字符串作为主键，类似`8f55d96b-8acc-4636-8cb8-76bf8abc2f57`。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键。

 对于大部分应用来说，通常自增类型的主键就能满足需求。我们在`students`表中定义的主键也是`BIGINT NOT NULL AUTO_INCREMENT`类型。

### 联合主键

关系型数据库也允许通过多个字段唯一标识记录，通过两个及以上的字段都设置成主键，这种主键被称为`联合主键`，对于联合主键，允许有一列重复，只要不是所有的主键列都重复即可。

| id\_num | id\_type | other columns... |
| :--- | :--- | :--- |
| 1 | A | ... |
| 2 | A | ... |
| 2 | B | ... |

如果我们把上述表的`id_num`和`id_type`这两列作为联合主键，那么上面的3条记录都是允许的，因为没有两列主键组合起来是相同的。

没有必要的情况下，我们尽量不使用联合主键，因为它给关系表带来了复杂度的上升。

### 外键

在一个数据表中，通过一个字段可以把数据与另一张表关联起来，这种列成为外键，外键不是通过列名实现的，而是通过定义外键约束实现的。

```text
ALTER TABLE students
ADD CONSTRAINT fk_class_id
FOREIGN KEY (class_id)
REFERENCES classes (id);
```

其中，外键约束的名称`fk_class_id`可以任意，`FOREIGN KEY (class_id)`指定了`class_id`作为外键，`REFERENCES classes (id)`指定了这个外键将关联到`classes`表的`id`列（即`classes`表的主键）。

通过定义外键约束，关系数据库可以保证无法插入无效的数据。即如果`classes`表不存在`id=99`的记录，`students`表就无法插入`class_id=99`的记录。

如果我们想删除一个外键约束我们可以利用`ALTER TABLE` 实现

```text
ALTER TABLE students
DROP FOREIGN KEY fk_class_id;
```

这里注意，删除外键约束并没有删除外键这一列，删除列是通过`DROP COLUMN` 实现的。

### 索引

如果想在大量数据中快速查找记录，就要使用索引，这样数据库系统不用扫描整个表，直接可以定位到条件符合的记录。

例如，对于`students`表：

| id | class\_id | name | gender | score |
| :--- | :--- | :--- | :--- | :--- |
| 1 | 1 | 小明 | M | 90 |
| 2 | 1 | 小红 | F | 95 |
| 3 | 1 | 小军 | M | 88 |

如果要经常根据`score`列进行查询，就可以对`score`列创建索引：

```text
ALTER TABLE students
ADD INDEX idx_score (score);
```

使用`ADD INDEX idx_score (score)`就创建了一个名称为`idx_score`，使用列`score`的索引。索引名称是任意的，索引如果有多列，可以在括号里依次写上，例如：

```text
ALTER TABLE students
ADD INDEX idx_name_score (name, score);
```

索引的效率取决于索引列的值是否`散列`，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如`gender`列，大约一半的记录值是`M`，另一半是`F`，因此，对该列创建索引就没有意义。

可以对一张表创建多个索引。索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。

对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。

### 唯一索引

在设计关系数据表的时候，看上去唯一的列，例如身份证号、邮箱地址等，因为他们具有业务含义，因此不宜作为主键。

但是，这些列根据业务要求，又具有唯一性约束：即不能出现两条记录存储了同一个身份证号。这个时候，就可以给该列添加一个唯一索引。例如，我们假设`students`表的`name`不能重复：

```text
ALTER TABLE students
ADD UNIQUE INDEX uni_name (name);
```

通过`UNIQUE`关键字我们就添加了一个唯一索引。

也可以只对某一列添加一个唯一约束而不创建唯一索引：

```text
ALTER TABLE students
ADD CONSTRAINT uni_name UNIQUE (name);
```

这种情况下，`name`列没有索引，但仍然具有唯一性保证。

无论是否创建索引，对于用户和应用程序来说，使用关系数据库不会有任何区别。这里的意思是说，当我们在数据库中查询时，如果有相应的索引可用，数据库系统就会自动使用索引来提高查询效率，如果没有索引，查询也能正常执行，只是速度会变慢。因此，索引可以在使用数据库的过程中逐步优化。

### 基本查询

`SELECT * FROM <表名>` 



## 参考资料

1. [SQL教程](**%5B**https://www.liaoxuefeng.com/wiki/1177760294764384**%5D%28https://www.liaoxuefeng.com/wiki/1177760294764384%29**)

\*\*\*\*

